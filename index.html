<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran | منصة القرآن الكريم</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --emerald-main: #064e3b;
            --amber-accent: #f59e0b;
            --card-bg: #e2e8f0; 
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8fafc;
            scroll-behavior: smooth;
        }

        .glass-header {
            background: #064e3b;
            border-bottom: 3px solid var(--amber-accent);
        }

        /* Grid for icons: 2 per row */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .feature-card {
            background: var(--card-bg);
            padding: 1.25rem 0.5rem;
            border-radius: 1.25rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.2s ease;
            border: 1px solid #cbd5e1;
            cursor: pointer;
            height: 140px;
        }

        .feature-card:active { transform: scale(0.95); }

        .feature-icon-wrapper {
            width: 45px;
            height: 45px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
            background: white;
            color: #064e3b;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Slim player */
        .mini-player {
            height: 70px;
            background: #064e3b;
        }

        /* Mushaf Container */
        .mushaf-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: pan-y;
        }

        .page-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 4px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #064e3b;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        footer {
            background: #022c22;
            color: white;
            padding: 1.5rem;
            margin-bottom: 80px;
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- Header -->
    <header class="glass-header text-white sticky top-0 z-50">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showHome()">
                <div class="bg-white p-1 rounded-lg">
                    <i class="fa-solid fa-book-quran text-lg text-emerald-900"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black text-amber-400 leading-none">Quran</h1>
                    <p class="text-[8px] text-emerald-100 font-bold mt-1">صدقة عن جميع المسلمين</p>
                </div>
            </div>
            <button onclick="toggleMobileMenu()" class="text-xl p-2"><i class="fa-solid fa-bars"></i></button>
        </div>
        <div id="mobileMenu" class="hidden bg-emerald-950 p-4 border-t border-emerald-800">
            <div class="flex flex-col gap-3 text-center text-sm">
                <button onclick="showHome()" class="py-2 border-b border-emerald-900/50 font-bold">الرئيسية</button>
                <button onclick="switchTab('reciters')" class="py-2 border-b border-emerald-900/50 font-bold">القراء</button>
                <button onclick="switchTab('mushaf')" class="py-2 border-b border-emerald-900/50 font-bold">المصحف</button>
                <a href="https://t.me/Sar7an_1" target="_blank" class="py-2 bg-amber-500 text-emerald-950 rounded-lg font-bold">تواصل معنا</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        
        <!-- Home -->
        <section id="home-section">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-black text-emerald-900">أهلاً بك في منصة القرآن</h2>
                <p class="text-slate-500 text-xs">كل ما تحتاجه للاستماع والتدبر في مكان واحد</p>
            </div>

            <div class="feature-grid max-w-md mx-auto">
                <a href="https://t.me/QuranDaily_1" target="_blank" class="feature-card">
                    <div class="feature-icon-wrapper"><i class="fa-brands fa-telegram"></i></div>
                    <h3 class="text-sm font-bold text-slate-800">قناة التليجرام</h3>
                </a>
                <div onclick="switchTab('radios')" class="feature-card">
                    <div class="feature-icon-wrapper"><i class="fa-solid fa-tower-broadcast"></i></div>
                    <h3 class="text-sm font-bold text-slate-800">الإذاعة</h3>
                </div>
                <div onclick="switchTab('reciters')" class="feature-card">
                    <div class="feature-icon-wrapper"><i class="fa-solid fa-microphone-lines"></i></div>
                    <h3 class="text-sm font-bold text-slate-800">القراء</h3>
                </div>
                <div onclick="switchTab('mushaf')" class="feature-card">
                    <div class="feature-icon-wrapper"><i class="fa-solid fa-book-open"></i></div>
                    <h3 class="text-sm font-bold text-slate-800">المصحف</h3>
                </div>
            </div>
        </section>

        <!-- Mushaf -->
        <section id="mushaf-section" class="hidden">
            <div class="mushaf-container" id="mushafLoaderBox">
                <div id="loader" class="loading-spinner absolute z-10"></div>
                <!-- Image source from archive for stability -->
                <img id="mushafPage" src="https://archive.org/download/quran-images-v2/1.png" class="page-img" alt="صفحة المصحف" onclick="handleMushafClick(event)" onload="hideLoader()">
            </div>
            <div class="mt-4 p-3 bg-slate-200 rounded-xl flex items-center justify-between gap-2 max-w-[500px] mx-auto">
                <input type="number" id="pageInput" value="1" min="1" max="604" onchange="jumpToPage()" class="w-12 p-1 text-center rounded-lg font-bold text-sm">
                <select id="surahSelect" onchange="jumpToSurah()" class="p-1 border rounded-lg text-[10px] font-bold bg-white flex-1"></select>
                <div class="flex gap-1">
                    <button onclick="nextPage()" class="p-2 bg-emerald-800 text-white rounded-lg text-xs font-bold">التالي</button>
                    <button onclick="prevPage()" class="p-2 bg-emerald-800 text-white rounded-lg text-xs font-bold">السابق</button>
                </div>
            </div>
        </section>

        <!-- Radios -->
        <section id="radios-section" class="hidden">
            <div id="radiosGrid" class="grid grid-cols-1 gap-2"></div>
        </section>

        <!-- Reciters -->
        <section id="reciters-section" class="hidden">
            <input type="text" id="searchBar" onkeyup="filterReciters()" placeholder="ابحث عن قارئ..." class="w-full p-2 mb-4 rounded-lg border-2 border-slate-200 text-sm outline-none">
            <div id="recitersGrid" class="grid grid-cols-2 gap-2"></div>
            <div id="surahModal" class="hidden mt-4 p-4 bg-white rounded-xl shadow-lg border border-slate-200">
                <h3 id="activeReciterName" class="font-black mb-3 text-emerald-900 border-b pb-2"></h3>
                <div id="surahsGrid" class="grid grid-cols-2 gap-2 overflow-y-auto max-h-60"></div>
                <button onclick="closeModal()" class="w-full mt-4 p-2 bg-red-50 text-red-500 rounded-lg font-bold text-xs">إغلاق</button>
            </div>
        </section>

    </main>

    <footer class="text-center">
        <p class="text-xs font-bold">© Sar7an_1 (2026)</p>
        <p class="text-[10px] opacity-60">صدقة جارية - نسألكم الدعاء</p>
    </footer>

    <!-- Mini Audio Player -->
    <div class="fixed bottom-0 left-0 right-0 mini-player text-white z-[100] px-4 flex items-center shadow-2xl">
        <div class="container mx-auto flex items-center justify-between gap-2">
            <div class="flex items-center gap-2 min-w-0 flex-1">
                <div class="w-9 h-9 bg-amber-500 rounded-lg flex items-center justify-center shrink-0"><i class="fa-solid fa-play text-emerald-950 text-sm"></i></div>
                <div class="min-w-0"><h4 id="trackName" class="text-[10px] font-bold truncate">اختر إذاعة أو قارئ</h4></div>
            </div>
            <button id="masterPlayBtn" onclick="toggleAudio()" class="w-10 h-10 bg-white text-emerald-900 rounded-full flex items-center justify-center shadow-lg"><i class="fa-solid fa-play ml-0.5"></i></button>
            <audio id="coreAudioEngine"></audio>
        </div>
    </div>

    <script>
        const audio = document.getElementById('coreAudioEngine');
        const playBtn = document.getElementById('masterPlayBtn');
        let cachedReciters = [];
        let currentPage = 1;

        const surahNames = ["الفاتحة", "البقرة", "آل عمران", "النساء", "المائدة", "الأنعام", "الأعراف", "الأنفال", "التوبة", "يونس", "هود", "يوسف", "الرعد", "إبراهيم", "الحجر", "النحل", "الإسراء", "الكهف", "مريم", "طه", "الأنبياء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنكبوت", "الروم", "لقمان", "السجدة", "الأحزاب", "سبأ", "فاطر", "يس", "الصافات", "ص", "الزمر", "غافر", "فصلت", "الشورى", "الزخرف", "الدخان", "الجاثية", "الأحقاف", "محمد", "الفتح", "الحجرات", "ق", "الذاريات", "الطور", "النجم", "القمر", "الرحمن", "الواقعة", "الحديد", "المجادلة", "الحشر", "الممتحنة", "الصف", "الجمعة", "المنافقون", "التغابن", "الطلاق", "التحريم", "الملك", "القلم", "الحاقة", "المعارج", "نوح", "الجن", "المزمل", "المدثر", "القيامة", "الإنسان", "المرسلات", "النبأ", "النازعات", "عبس", "التكوير", "الإنفطار", "المطففين", "الإنشقاق", "البروج", "الطارق", "الأعلى", "الغاشية", "الفجر", "البلد", "الشمس", "الليل", "الضحى", "الشرح", "التين", "العلق", "القدر", "البينة", "الزلزلة", "العاديات", "القارعة", "التكاثر", "العصر", "الهمزة", "الفيل", "قريش", "الماعون", "الكوثر", "الكافرون", "النصر", "المسد", "الإخلاص", "الفلق", "الناس"];
        const surahPages = [1, 2, 50, 77, 106, 128, 151, 177, 187, 208, 221, 235, 249, 255, 262, 267, 282, 293, 305, 312, 322, 332, 342, 350, 359, 367, 377, 385, 396, 404, 411, 415, 418, 428, 434, 440, 446, 453, 458, 467, 477, 483, 489, 496, 499, 502, 507, 511, 515, 518, 520, 523, 526, 528, 531, 534, 537, 542, 545, 549, 551, 553, 554, 556, 558, 560, 562, 564, 566, 568, 570, 572, 574, 575, 577, 578, 580, 582, 583, 585, 587, 587, 589, 590, 591, 592, 593, 594, 595, 596, 596, 597, 598, 598, 599, 599, 600, 600, 601, 601, 602, 602, 603, 603, 603, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604, 604];

        window.onload = () => { init(); fillSurahSelect(); };

        async function init() {
            try { loadRadios(); loadReciters(); } catch(e){}
            audio.onplay = () => playBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
            audio.onpause = () => playBtn.innerHTML = '<i class="fa-solid fa-play ml-0.5"></i>';
        }

        function handleMushafClick(e) {
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            // RTL: Left Side -> Next (Increase page), Right Side -> Prev (Decrease page)
            if (x < rect.width / 2) nextPage(); else prevPage();
        }

        function hideLoader() { document.getElementById('loader').style.display = 'none'; }
        
        function updateMushaf() {
            document.getElementById('loader').style.display = 'block';
            document.getElementById('mushafPage').src = `https://archive.org/download/quran-images-v2/${currentPage}.png`;
            document.getElementById('pageInput').value = currentPage;
        }

        function nextPage() { if(currentPage < 604) { currentPage++; updateMushaf(); } }
        function prevPage() { if(currentPage > 1) { currentPage--; updateMushaf(); } }
        
        function jumpToPage() { 
            let v = parseInt(document.getElementById('pageInput').value); 
            if(v >= 1 && v <= 604) { currentPage = v; updateMushaf(); } 
        }

        function jumpToSurah() { 
            currentPage = parseInt(document.getElementById('surahSelect').value); 
            updateMushaf(); 
        }

        function fillSurahSelect() {
            const s = document.getElementById('surahSelect');
            surahNames.forEach((n, i) => { s.add(new Option(n, surahPages[i])); });
        }

        function showHome() {
            ['home', 'radios', 'reciters', 'mushaf'].forEach(id => document.getElementById(id+'-section').classList.add('hidden'));
            document.getElementById('home-section').classList.remove('hidden');
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        function switchTab(id) {
            ['home', 'radios', 'reciters', 'mushaf'].forEach(t => document.getElementById(t+'-section').classList.add('hidden'));
            document.getElementById(id+'-section').classList.remove('hidden');
            document.getElementById('mobileMenu').classList.add('hidden');
            if(id === 'mushaf') updateMushaf();
            window.scrollTo(0, 0);
        }

        function toggleMobileMenu() { document.getElementById('mobileMenu').classList.toggle('hidden'); }

        async function loadRadios() {
            const res = await fetch('https://mp3quran.net/api/v3/radios?language=ar');
            const data = await res.json();
            document.getElementById('radiosGrid').innerHTML = data.radios.map(r => `
                <div class="bg-slate-200 p-3 rounded-lg flex items-center gap-2 cursor-pointer active:bg-emerald-100" onclick="play('${r.url}', '${r.name}')">
                    <i class="fa-solid fa-radio text-emerald-800"></i>
                    <span class="text-[10px] font-bold truncate">${r.name}</span>
                </div>
            `).join('');
        }

        async function loadReciters() {
            const res = await fetch('https://www.mp3quran.net/api/v3/reciters?language=ar');
            const data = await res.json();
            cachedReciters = data.reciters;
            renderReciters(cachedReciters.slice(0, 30));
        }

        function renderReciters(list) {
            document.getElementById('recitersGrid').innerHTML = list.map(r => `
                <div class="bg-slate-200 p-3 rounded-xl text-center cursor-pointer active:bg-emerald-100" onclick="openReciter('${r.id}')">
                    <h3 class="text-[10px] font-black truncate">${r.name}</h3>
                </div>
            `).join('');
        }

        function filterReciters() {
            const q = document.getElementById('searchBar').value.toLowerCase();
            renderReciters(cachedReciters.filter(r => r.name.toLowerCase().includes(q)).slice(0, 30));
        }

        function openReciter(id) {
            const r = cachedReciters.find(x => x.id == id);
            if(!r) return;
            const m = r.moshaf[0];
            document.getElementById('activeReciterName').innerText = r.name;
            document.getElementById('surahsGrid').innerHTML = m.surah_list.split(',').map(sId => {
                const n = surahNames[parseInt(sId)-1];
                const u = `${m.server}${sId.padStart(3, '0')}.mp3`;
                return `<button onclick="play('${u}', 'سورة ${n}')" class="p-2 bg-slate-100 rounded text-[9px] font-bold border border-slate-200">${n}</button>`;
            }).join('');
            document.getElementById('surahModal').classList.remove('hidden');
            document.getElementById('surahModal').scrollIntoView({ behavior: 'smooth' });
        }

        function closeModal() { document.getElementById('surahModal').classList.add('hidden'); }

        function play(url, title) {
            audio.src = url;
            document.getElementById('trackName').innerText = title;
            audio.play();
        }

        function toggleAudio() { if(!audio.src) return; audio.paused ? audio.play() : audio.pause(); }
    </script>
</body>
        </html>
