const audio = document.getElementById('main-audio');
const playIcon = document.getElementById('play-icon');
const trackTitle = document.getElementById('track-title');

// ุชุจุฏูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('active');
}

// ุชุจุฏูู ุงููุถุน ุงููููู
function toggleTheme() {
    const body = document.body;
    const btn = document.getElementById('theme-btn');
    if (body.classList.contains('light-mode')) {
        body.classList.replace('light-mode', 'dark-mode');
        btn.innerHTML = '<i class="fas fa-sun"></i> ุงููุถุน ุงูููุงุฑู';
    } else {
        body.classList.replace('dark-mode', 'light-mode');
        btn.innerHTML = '<i class="fas fa-moon"></i> ุงููุถุน ุงููููู';
    }
}

// ุชุดุบูู ุงูุตูุช
function playAudio(url, title) {
    audio.src = url;
    audio.play().then(() => {
        trackTitle.innerText = title;
        playIcon.className = 'fas fa-pause';
        if (document.getElementById('sidebar').classList.contains('active')) toggleSidebar();
    }).catch(() => { trackTitle.innerText = "ุฎุทุฃ ูู ุชุดุบูู ุงููุตุฏุฑ"; });
}

function togglePlay() {
    if (!audio.src) return;
    if (audio.paused) { audio.play(); playIcon.className = 'fas fa-pause'; }
    else { audio.pause(); playIcon.className = 'fas fa-play'; }
}

function skip(time) { audio.currentTime += time; }

document.getElementById('volControl').oninput = function() { audio.volume = this.value; };

// ุจูุงูุงุช ุงูุฃุฐูุงุฑ
const morningAzkar = [
    { text: "1๏ธโฃ ุฃูุนููุฐู ุจูุงูููููู ูููู ุงูุดููููุทูุงูู ุงูุฑููุฌูููู: ๏ดฟุงูููููู ููุง ุฅููููฐูู ุฅููููุง ูููู ุงููุญูููู ุงูููููููููู...๏ดพ", count: 1 },
    { text: "2๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ูููู ุงูููููู ุฃูุญูุฏู...๏ดพ", count: 3 },
    { text: "3๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงูููููููู...๏ดพ", count: 3 },
    { text: "4๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงููููุงุณู...๏ดพ", count: 3 },
    { text: "5๏ธโฃ ุฃูุตูุจูุญูููุง ููุฃูุตูุจูุญู ุงูููููููู ููููููู... ุฑูุจูู ุฃูุณูุฃููููู ุฎูููุฑู ููุง ููู ููุฐูุง ุงูููููููู ููุฎูููุฑู ููุง ุจูุนูุฏููู", count: 1 },
    { text: "6๏ธโฃ ุงููููููููู ุจููู ุฃูุตูุจูุญูููุงุ ููุจููู ุฃูููุณูููููุงุ ููุจููู ููุญูููุงุ ููุจููู ูููููุชูุ ููุฅููููููู ุงููููุดููุฑู.", count: 1 },
    { text: "7๏ธโฃ ุณูุฏ ุงูุงุณุชุบูุงุฑ: ุงููููููููู ุฃูููุชู ุฑูุจููู ููุง ุฅููููฐูู ุฅููููุง ุฃูููุชู... ููุงุบูููุฑู ููู ููุฅูููููู ููุง ููุบูููุฑู ุงูุฐูููููุจู ุฅููููุง ุฃูููุชู.", count: 1 },
    { text: "8๏ธโฃ ุฑูุถููุชู ุจูุงูููููู ุฑูุจููุงุ ููุจูุงููุฅูุณูููุงูู ุฏููููุงุ ููุจูููุญููููุฏู ๏ทบ ููุจููููุง.", count: 3 },
    { text: "9๏ธโฃ ุงููููููููู ุฅููููู ุฃูุตูุจูุญูุชู ุฃูุดูููุฏููู... ุฃูููููู ุฃูููุชู ุงูููููู ููุง ุฅููููฐูู ุฅููููุง ุฃูููุชู", count: 4 },
    { text: "๐ ุงููููููููู ููุง ุฃูุตูุจูุญู ุจูู ูููู ููุนูููุฉู... ูููููู ุงููุญูููุฏู ูููููู ุงูุดููููุฑู.", count: 1 },
    { text: "1๏ธโฃ1๏ธโฃ ุญูุณูุจููู ุงูููููู ููุง ุฅููููฐูู ุฅููููุง ููููุ ุนููููููู ุชููููููููุชูุ ูููููู ุฑูุจูู ุงููุนูุฑูุดู ุงููุนูุธูููู.", count: 7 },
    { text: "1๏ธโฃ2๏ธโฃ ุจูุณููู ุงูููููู ุงูููุฐูู ููุง ููุถูุฑูู ููุนู ุงุณููููู ุดูููุกู ููู ุงููุฃูุฑูุถู ููููุง ููู ุงูุณููููุงุกู...", count: 3 },
    { text: "1๏ธโฃ3๏ธโฃ ุงููููููููู ุนูุงููููู ููู ุจูุฏููููุ ุงููููููููู ุนูุงููููู ููู ุณูููุนููุ ุงููููููููู ุนูุงููููู ููู ุจูุตูุฑูู...", count: 3 },
    { text: "1๏ธโฃ4๏ธโฃ ููุง ุญูููู ููุง ููููููููุ ุจูุฑูุญูููุชููู ุฃูุณูุชูุบููุซูุ ุฃูุตูููุญู ููู ุดูุฃูููู ููููููู...", count: 3 },
    { text: "1๏ธโฃ5๏ธโฃ ุณูุจูุญูุงูู ุงูููููู ููุจูุญูููุฏููู.", count: 100 },
    { text: "1๏ธโฃ6๏ธโฃ ููุง ุฅููููฐูู ุฅููููุง ุงูููููู ููุญูุฏููู ููุง ุดูุฑูููู ููููุ ูููู ุงูููููููู ูููููู ุงููุญูููุฏู...", count: 100 }
];

const eveningAzkar = [
    { text: "1๏ธโฃ ุฃูุนููุฐู ุจูุงูููููู ูููู ุงูุดููููุทูุงูู ุงูุฑููุฌูููู: ๏ดฟุงูููููู ููุง ุฅููููฐูู ุฅููููุง ูููู ุงููุญูููู ุงูููููููููู...๏ดพ", count: 1 },
    { text: "2๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ูููู ุงูููููู ุฃูุญูุฏู...๏ดพ", count: 3 },
    { text: "3๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงูููููููู...๏ดพ", count: 3 },
    { text: "4๏ธโฃ ุจูุณููู ุงูููููู ุงูุฑููุญููููฐูู ุงูุฑููุญูููู: ๏ดฟูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงููููุงุณู...๏ดพ", count: 3 },
    { text: "5๏ธโฃ ุฃูููุณูููููุง ููุฃูููุณูู ุงูููููููู ููููููู... ุฑูุจูู ุฃูุณูุฃููููู ุฎูููุฑู ููุง ููู ููุฐููู ุงููููููููุฉู ููุฎูููุฑู ููุง ุจูุนูุฏูููุง", count: 1 },
    { text: "6๏ธโฃ ุงููููููููู ุจููู ุฃูููุณูููููุงุ ููุจููู ุฃูุตูุจูุญูููุงุ ููุจููู ููุญูููุงุ ููุจููู ูููููุชูุ ููุฅููููููู ุงููููุตููุฑู.", count: 1 },
    { text: "7๏ธโฃ ุณูุฏ ุงูุงุณุชุบูุงุฑ: ุงููููููููู ุฃูููุชู ุฑูุจููู ููุง ุฅููููฐูู ุฅููููุง ุฃูููุชู... ููุงุบูููุฑู ููู ููุฅูููููู ููุง ููุบูููุฑู ุงูุฐูููููุจู ุฅููููุง ุฃูููุชู.", count: 1 },
    { text: "8๏ธโฃ ุฑูุถููุชู ุจูุงูููููู ุฑูุจููุงุ ููุจูุงููุฅูุณูููุงูู ุฏููููุงุ ููุจูููุญููููุฏู ๏ทบ ููุจููููุง.", count: 3 },
    { text: "9๏ธโฃ ุงููููููููู ุฅููููู ุฃูููุณูููุชู ุฃูุดูููุฏููู... ุฃูููููู ุฃูููุชู ุงูููููู ููุง ุฅููููฐูู ุฅููููุง ุฃูููุชู", count: 4 },
    { text: "๐ ุงููููููููู ููุง ุฃูููุณูู ุจูู ูููู ููุนูููุฉู... ูููููู ุงููุญูููุฏู ูููููู ุงูุดููููุฑู.", count: 1 },
    { text: "1๏ธโฃ1๏ธโฃ ุญูุณูุจููู ุงูููููู ููุง ุฅููููฐูู ุฅููููุง ููููุ ุนููููููู ุชููููููููุชูุ ูููููู ุฑูุจูู ุงููุนูุฑูุดู ุงููุนูุธูููู.", count: 7 },
    { text: "1๏ธโฃ2๏ธโฃ ุจูุณููู ุงูููููู ุงูููุฐูู ููุง ููุถูุฑูู ููุนู ุงุณููููู ุดูููุกู ููู ุงููุฃูุฑูุถู ููููุง ููู ุงูุณููููุงุกู...", count: 3 },
    { text: "1๏ธโฃ3๏ธโฃ ุงููููููููู ุนูุงููููู ููู ุจูุฏููููุ ุงููููููููู ุนูุงููููู ููู ุณูููุนููุ ุงููููููููู ุนูุงููููู ููู ุจูุตูุฑูู...", count: 3 },
    { text: "1๏ธโฃ4๏ธโฃ ุฃูุนููุฐู ุจูููููููุงุชู ุงูููููู ุงูุชููุงูููุงุชู ูููู ุดูุฑูู ููุง ุฎููููู.", count: 3 },
    { text: "1๏ธโฃ5๏ธโฃ ููุง ุญูููู ููุง ููููููููุ ุจูุฑูุญูููุชููู ุฃูุณูุชูุบููุซูุ ุฃูุตูููุญู ููู ุดูุฃูููู ููููููู...", count: 3 },
    { text: "1๏ธโฃ6๏ธโฃ ุณูุจูุญูุงูู ุงูููููู ููุจูุญูููุฏููู.", count: 100 },
    { text: "1๏ธโฃ7๏ธโฃ ููุง ุฅููููฐูู ุฅููููุง ุงูููููู ููุญูุฏููู ููุง ุดูุฑูููู ููููุ ูููู ุงูููููููู ูููููู ุงููุญูููุฏู...", count: 100 }
];

async function openReciters() {
    showPage("<p class='text-center'>ุฌุงุฑู ุงูุชุญููู...</p>");
    try {
        const res = await fetch('https://mp3quran.net/api/v3/reciters?language=ar');
        const data = await res.json();
        let html = `<div class="sticky-nav"><button onclick="goHome()" class="back-btn">ุฑุฌูุน ููุฑุฆูุณูุฉ</button></div>`;
        html += data.reciters.slice(0, 50).map(r => `
            <div class="card mb-3 flex justify-between items-center px-4" style="padding:15px" onclick="openSurahs('${r.moshaf[0].server}', '${r.name}', '${r.moshaf[0].surah_list}')">
                <span class="text-xs font-bold">${r.name}</span>
                <i class="fas fa-chevron-left text-gray-400"></i>
            </div>
        `).join('');
        document.getElementById('content-area').innerHTML = html;
    } catch (e) { document.getElementById('content-area').innerHTML = "ุฎุทุฃ ูู ุงูุงุชุตุงู"; }
}

function openSurahs(server, name, list) {
    const sArray = list.split(',');
    let html = `<div class="sticky-nav"><button onclick="openReciters()" class="back-btn">ุฑุฌูุน ูููุฑุงุก</button><span class="text-[10px] font-bold">${name}</span></div><div class="menu-grid">`;
    sArray.forEach(sNum => {
        const sName = surahNames[parseInt(sNum) - 1];
        html += `<div class="card" onclick="playAudio('${server}${sNum.padStart(3, '0')}.mp3', '${name} - ${sName}')"><span>${sName}</span></div>`;
    });
    html += `</div>`;
    document.getElementById('content-area').innerHTML = html;
    window.scrollTo(0,0);
}

function openAzkar() {
    let html = `<div class="sticky-nav"><button onclick="goHome()" class="back-btn">ุฑุฌูุน</button></div>
    <div class="menu-grid">
        <div class="card" onclick="loadAzkar('morning')">โ๏ธ ุฃุฐูุงุฑ ุงูุตุจุงุญ</div>
        <div class="card" onclick="loadAzkar('evening')">๐ ุฃุฐูุงุฑ ุงููุณุงุก</div>
    </div>`;
    showPage(html);
}

function loadAzkar(t) {
    const azkar = t === 'morning' ? morningAzkar : eveningAzkar;
    const title = t === 'morning' ? 'ุฃุฐูุงุฑ ุงูุตุจุงุญ' : 'ุฃุฐูุงุฑ ุงููุณุงุก';
    
    let html = `<div class="sticky-nav"><button onclick="openAzkar()" class="back-btn">ุฑุฌูุน</button><span class="font-bold text-xs">${title}</span></div>`;
    azkar.forEach((zekr, index) => {
        html += `
            <div class="card mb-4 text-right" style="border-right: 5px solid #fbbf24; padding: 18px;">
                <p class="text-[13px] leading-relaxed mb-4">${zekr.text}</p>
                <div class="flex justify-between items-center">
                    <span class="text-[10px] opacity-50">ุงููุทููุจ: ${zekr.count}</span>
                    <button id="cnt-${index}" onclick="updateCounter(${index})" class="zekr-counter">${zekr.count}</button>
                </div>
            </div>`;
    });
    document.getElementById('content-area').innerHTML = html;
}

function updateCounter(idx) {
    const btn = document.getElementById(`cnt-${idx}`);
    let val = parseInt(btn.innerText);
    if (!isNaN(val) && val > 0) {
        val--;
        btn.innerText = val === 0 ? "โ" : val;
        if (val === 0) btn.classList.add('completed');
    }
}

function showPage(html) {
    document.getElementById('home-view').classList.add('hidden');
    document.getElementById('sub-view').classList.remove('hidden');
    document.getElementById('content-area').innerHTML = html;
    window.scrollTo(0,0);
}

function goHome() {
    document.getElementById('home-view').classList.remove('hidden');
    document.getElementById('sub-view').classList.add('hidden');
}

const surahNames = ["ุงููุงุชุญุฉ","ุงูุจูุฑุฉ","ุขู ุนูุฑุงู","ุงููุณุงุก","ุงููุงุฆุฏุฉ","ุงูุฃูุนุงู","ุงูุฃุนุฑุงู","ุงูุฃููุงู","ุงูุชูุจุฉ","ูููุณ","ููุฏ","ููุณู","ุงูุฑุนุฏ","ุฅุจุฑุงููู","ุงูุญุฌุฑ","ุงููุญู","ุงูุฅุณุฑุงุก","ุงูููู","ูุฑูู","ุทู","ุงูุฃูุจูุงุก","ุงูุญุฌ","ุงููุคูููู","ุงูููุฑ","ุงููุฑูุงู","ุงูุดุนุฑุงุก","ุงูููู","ุงููุตุต","ุงูุนููุจูุช","ุงูุฑูู","ูููุงู","ุงูุณุฌุฏุฉ","ุงูุฃุญุฒุงุจ","ุณุจุฃ","ูุงุทุฑ","ูุณ","ุงูุตุงูุงุช","ุต","ุงูุฒูุฑ","ุบุงูุฑ","ูุตูุช","ุงูุดูุฑู","ุงูุฒุฎุฑู","ุงูุฏุฎุงู","ุงูุฌุงุซูุฉ","ุงูุฃุญูุงู","ูุญูุฏ","ุงููุชุญ","ุงูุญุฌุฑุงุช","ู","ุงูุฐุงุฑูุงุช","ุงูุทูุฑ","ุงููุฌู","ุงูููุฑ","ุงูุฑุญูู","ุงููุงูุนุฉ","ุงูุญุฏูุฏ","ุงููุฌุงุฏูุฉ","ุงูุญุดุฑ","ุงูููุชุญูุฉ","ุงูุตู","ุงูุฌูุนุฉ","ุงูููุงูููู","ุงูุชุบุงุจู","ุงูุทูุงู","ุงูุชุญุฑูู","ุงูููู","ุงูููู","ุงูุญุงูุฉ","ุงููุนุงุฑุฌ","ููุญ","ุงูุฌู","ุงููุฒูู","ุงููุฏุซุฑ","ุงูููุงูุฉ","ุงูุฅูุณุงู","ุงููุฑุณูุงุช","ุงููุจุฃ","ุงููุงุฒุนุงุช","ุนุจุณ","ุงูุชูููุฑ","ุงูุงููุทุงุฑ","ุงููุทูููู","ุงูุงูุดูุงู","ุงูุจุฑูุฌ","ุงูุทุงุฑู","ุงูุฃุนูู","ุงูุบุงุดูุฉ","ุงููุฌุฑ","ุงูุจูุฏ","ุงูุดูุณ","ุงูููู","ุงูุถุญู","ุงูุดุฑุญ","ุงูุชูู","ุงูุนูู","ุงููุฏุฑ","ุงูุจููุฉ","ุงูุฒูุฒูุฉ","ุงูุนุงุฏูุงุช","ุงููุงุฑุนุฉ","ุงูุชูุงุซุฑ","ุงูุนุตุฑ","ุงูููุฒุฉ","ุงูููู","ูุฑูุด","ุงููุงุนูู","ุงูููุซุฑ","ุงููุงูุฑูู","ุงููุตุฑ","ุงููุณุฏ","ุงูุฅุฎูุงุต","ุงูููู","ุงููุงุณ"];